CREATE PROCEDURE SP_WORKER_INOUT
@WORKERBARCODE AS VARCHAR(50),
@DATE AS DATETIME,
@IOTYPE AS VARCHAR(1),
@GATEID AS INT
AS
BEGIN
	DECLARE @WORKERNAME AS VARCHAR(100)
	DECLARE @WORKERID AS INT
	DECLARE @LASTIO AS VARCHAR(1)
	SELECT @WORKERNAME = WORKERNAME, @WORKERID = ID FROM WORKERS WHERE WORKERBARCODE = @WORKERBARCODE 
	IF @WORKERID IS NULL
	BEGIN
		RAISERROR('OKUTULAN KART GEÇERSÝZDÝR', 16, 1)
		RETURN
	END
	SELECT TOP 1 @LASTIO = IOTYPE FROM WORKERTRANSACTIONS
	WHERE WORKERID = 1 AND DATE_ >= CONVERT(DATE, GETDATE())
	ORDER BY DATE_ DESC
	IF @LASTIO = @IOTYPE
	BEGIN
		IF @IOTYPE = 'G'
		BEGIN
			RAISERROR('ZATEN ÝÇERÝDE GÖZÜKÜYORSUNUZ, GÝRÝÞ YAPAMAZSINIZ', 16,1)
			RETURN
		END
		IF @IOTYPE = 'C'
		BEGIN
			RAISERROR('ZATEN DIÞARIDA GÖZÜKÜYORSUNUZ, ÇIKIÞ YAPAMAZSINIZ', 16,1)
			RETURN
		END
	END
	INSERT INTO WORKERTRANSACTIONS ([WORKERID], [DATE_], [IOTYPE], [GATEID])
	VALUES (@WORKERID, @DATE,@IOTYPE, @GATEID)

SELECT @WORKERNAME AS WORKERNAME, @DATE AS DATE_, @IOTYPE AS IOTYPE  
END

-------------------------------------------------------------
-------------------------------------------------------------
-------------------------------------------------------------
TRUNCATE TABLE WORKERTRANSACTIONS
SELECT * FROM  WORKERTRANSACTIONS

EXECUTE SP_WORKER_INOUT 'B3CEEB5F-9BB9-4D29-B807-B412473C3EAC',
'2022-11-05 08:00:00', 'G', 1
EXECUTE SP_WORKER_INOUT 'B3CEEB5F-9BB9-4D29-B807-B412473C3EAC',
'2022-11-05 10:05:20', 'C', 1
EXECUTE SP_WORKER_INOUT 'B3CEEB5F-9BB9-4D29-B807-B412473C3EAC',
'2022-11-05 10:10:25', 'G', 1
EXECUTE SP_WORKER_INOUT 'B3CEEB5F-9BB9-4D29-B807-B412473C3EAC',
'2022-11-05 12:05:34', 'C', 1
EXECUTE SP_WORKER_INOUT 'B3CEEB5F-9BB9-4D29-B807-B412473C3EAC',
'2022-11-05 13:05:12', 'G', 1
EXECUTE SP_WORKER_INOUT 'B3CEEB5F-9BB9-4D29-B807-B412473C3EAC',
'2022-11-05 15:05:00', 'C', 5
EXECUTE SP_WORKER_INOUT 'B3CEEB5F-9BB9-4D29-B807-B412473C3EAC',
'2022-11-05 15:16:28', 'G', 3
EXECUTE SP_WORKER_INOUT 'B3CEEB5F-9BB9-4D29-B807-B412473C3EAC',
'2022-11-05 17:36:48', 'C', 7
SELECT * FROM WORKERS 
SELECT * FROM  WORKERTRANSACTIONS